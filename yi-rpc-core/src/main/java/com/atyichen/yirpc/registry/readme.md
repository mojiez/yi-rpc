# 注册中心
## 本地注册中心
## 服务注册中心
帮助服务消费者获取到服务提供者的调用地址， 而不是将地址硬编码到项目中
### 核心能力
1. 数据分布式存储： 集中的注册信息数据存储、读取和共享
2. 服务注册： 服务提供者上报服务消息到注册中心
3. 服务发现： 服务消费者从注册中心拉取服务信息
4. 心跳检测： 定期检查服务提供者的存活状态
5. 服务注销： 手动剔除节点、或者自动剔除失效节点

### 注册中心优化
1. 心跳检测和续期机制
    定期发送心跳信号💗(请求)，来检测目标系统的状态，如果接收方在一定时间内未能正常响应请求， 就认为目标系统故障或不可用
   Etcd中，要实现心跳检测和续期机制的步骤
    - 服务提供者注册信息， 在注册时设置TTL
    - Etcd维护， 到期删除
    - 服务提供者定期向Etcd请求续期
2. 服务节点下线机制
    当服务提供者节点宕机时， 应该从注册中心移除掉已经注册的节点， 否则会影响消费端调用
    - 主动下线
        正常推出时， 主动从注册中心移除注册信息
        如何在java项目正常退出时，执行某个操作？——利用JVM的ShutdownHook
    - 被动下线
        提供者项目异常推出时， 利用Etcd的key过期机制自动移除 （已经实现）
3. 消费端服务缓存
    正常情况下， 服务节点的信息列表的更新频率不高，所以在服务消费者从注册中心获取到服务节点信息列表后， 完全可以**缓存在本地**，下次就不用再请求注册中心获取了， 能提高性能
    当服务注册信息发生变更（比如节点下线）时， 需要即时更新消费端缓存
    问题是， 怎么知道服务注册信息什么时候发生变更呢？
    使用Etcd的watch监听机制， 当监听的某个key发生修改或删除时， 就会触发事件来通知监听者
    显然是服务消费者来监听， 在服务发现中对本次获取到的所有服务节点key进行监听。 
    还需要防止重复监听同一个key
4. 基于zookeeper的注册中心实现